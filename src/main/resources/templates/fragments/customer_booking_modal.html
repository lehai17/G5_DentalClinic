<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="bookingModal(services)" id="customer-booking-modal" class="customer-modal" role="dialog" aria-modal="true" aria-labelledby="customer-booking-title" aria-hidden="true">
  <div class="customer-modal-backdrop" data-close="customer-booking-modal"></div>
  <div class="customer-modal-box customer-modal-box--booking">
    <div class="customer-modal-header">
      <h2 id="customer-booking-title" class="customer-modal-title">Đặt lịch khám</h2>
      <button type="button" class="customer-modal-close" data-close="customer-booking-modal" aria-label="Đóng">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <div class="customer-modal-body">
      <div class="customer-booking-stepper">
        <div class="customer-stepper-indicator">
          <span class="customer-stepper-step active" data-step="1">1</span>
          <span class="customer-stepper-line"></span>
          <span class="customer-stepper-step" data-step="2">2</span>
          <span class="customer-stepper-line"></span>
          <span class="customer-stepper-step" data-step="3">3</span>
          <span class="customer-stepper-line"></span>
          <span class="customer-stepper-step" data-step="4">4</span>
          <span class="customer-stepper-line"></span>
          <span class="customer-stepper-step" data-step="5">5</span>
        </div>
        <p class="customer-stepper-label" data-step-label="1">Chọn ngày</p>
        <p class="customer-stepper-label" data-step-label="2" style="display:none;">Chọn giờ</p>
        <p class="customer-stepper-label" data-step-label="3" style="display:none;">Thông tin liên hệ</p>
        <p class="customer-stepper-label" data-step-label="4" style="display:none;">Đặt cọc giữ chỗ</p>
        <p class="customer-stepper-label" data-step-label="5" style="display:none;">Hoàn tất</p>
      </div>

      <!-- Step 1: Dịch vụ + Bảng lịch (calendar) -->
      <div class="customer-booking-step" id="customer-booking-step-1">
        <div class="customer-form-row">
          <label>Dịch vụ <span class="required">*</span></label>
          <select id="customer-booking-service" class="customer-input" required>
            <option value="">-- Chọn dịch vụ --</option>
            <option th:each="s : ${services}" th:value="${s.id}" th:text="${s.name}">Dịch vụ</option>
          </select>
        </div>
        <div class="customer-calendar-wrap">
          <div class="customer-calendar-nav">
            <button type="button" id="customer-calendar-prev" class="customer-calendar-nav-btn"><i class="bi bi-chevron-left"></i></button>
            <span id="customer-calendar-month-label" class="customer-calendar-month-label">Tháng 1 / 2025</span>
            <button type="button" id="customer-calendar-next" class="customer-calendar-nav-btn"><i class="bi bi-chevron-right"></i></button>
          </div>
          <table class="customer-calendar-table" id="customer-calendar-table">
            <thead>
              <tr><th>CN</th><th>T2</th><th>T3</th><th>T4</th><th>T5</th><th>T6</th><th>T7</th></tr>
            </thead>
            <tbody id="customer-calendar-body"></tbody>
          </table>
        </div>
      </div>

      <!-- Step 2: Bảng chọn thời gian -->
      <div class="customer-booking-step" id="customer-booking-step-2" style="display:none;">
        <p class="customer-step-date-label">Ngày đã chọn: <strong id="customer-selected-date-label"></strong></p>
        <div id="customer-times-loading" class="customer-loading">Đang tải khung giờ...</div>
        <div id="customer-times-wrap" style="display:none;">
          <table class="customer-times-table" id="customer-times-table">
            <thead><tr><th>Khung giờ</th><th>Trạng thái</th></tr></thead>
            <tbody id="customer-times-body"></tbody>
          </table>
          <p id="customer-times-empty" class="customer-empty" style="display:none;">Không có khung giờ trống.</p>
        </div>
        <div class="customer-modal-actions" style="margin-top:16px;">
          <button type="button" class="customer-btn" data-back-step="1">Quay lại chọn ngày</button>
        </div>
      </div>

      <!-- Step 3: Thông tin liên hệ -->
      <div class="customer-booking-step" id="customer-booking-step-3" style="display:none;">
        <input type="hidden" id="customer-booking-slot-id" value="">
        <div class="customer-form-row">
          <label>Kênh liên hệ <span class="required">*</span></label>
          <select id="customer-booking-contact-channel" class="customer-input" required>
            <option value="">-- Chọn --</option>
            <option value="ZALO">Zalo</option>
            <option value="EMAIL">Email</option>
            <option value="PHONE">Điện thoại</option>
          </select>
        </div>
        <div class="customer-form-row">
          <label>Số / Email / Zalo <span class="required">*</span></label>
          <input type="text" id="customer-booking-contact-value" class="customer-input" placeholder="Số điện thoại, email hoặc ID Zalo" required>
        </div>
        <div class="customer-form-row">
          <label>Ghi chú (tùy chọn)</label>
          <textarea id="customer-booking-note" class="customer-input" rows="2" placeholder="Ghi chú cho phòng khám"></textarea>
        </div>
        <div class="customer-modal-actions">
          <button type="button" class="customer-btn" data-back-step="2">Quay lại</button>
          <button type="button" id="customer-booking-to-deposit" class="customer-btn customer-btn-primary">Tiếp theo</button>
        </div>
      </div>

      <!-- Step 4: Đặt cọc giữ chỗ -->
      <div class="customer-booking-step" id="customer-booking-step-4" style="display:none;">
        <div class="customer-deposit-message">
          <i class="bi bi-info-circle-fill"></i>
          <p>Nhân viên sẽ liên hệ qua kênh bạn chọn để hướng dẫn đặt cọc giữ chỗ.</p>
          <p class="customer-deposit-note">Xác nhận để hoàn tất đặt lịch.</p>
        </div>
        <div class="customer-modal-actions">
          <button type="button" class="customer-btn" data-back-step="3">Quay lại</button>
          <button type="button" id="customer-booking-submit" class="customer-btn customer-btn-primary">Xác nhận đặt cọc</button>
        </div>
      </div>

      <!-- Step 5: Thanh toán thành công -->
      <div class="customer-booking-step" id="customer-booking-step-5" style="display:none;">
        <div class="customer-success-message">
          <i class="bi bi-check-circle-fill"></i>
          <p class="customer-success-title">Đặt lịch thành công!</p>
          <p>Nhân viên sẽ liên hệ qua kênh bạn chọn để hướng dẫn đặt cọc.</p>
        </div>
        <div class="customer-modal-actions">
          <button type="button" id="customer-booking-open-appointments" class="customer-btn customer-btn-primary">Xem lịch hẹn của tôi</button>
          <button type="button" class="customer-btn" data-close="customer-booking-modal">Đóng</button>
        </div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
