<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B·∫£ng ƒëi·ªÅu khi·ªÉn</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
          rel="stylesheet">

    <!-- Chart.js for statistics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <!-- Patient CSS -->
    <link rel="stylesheet" th:href="@{/css/patient/layout.css}">
    <link rel="stylesheet" th:href="@{/css/patient/sidebar.css}">
    <link rel="stylesheet" th:href="@{/css/patient/topbar.css}">
    <link rel="stylesheet" th:href="@{/css/patient/dashboard.css}">
</head>

<body>

<!-- ===== TOPBAR ===== -->
<div th:replace="~{patient/fragments/topbar :: topbar}"></div>

<!-- ===== SIDEBAR ===== -->
<div th:replace="~{patient/fragments/sidebar :: sidebar}"></div>

<!-- ===== MAIN CONTENT ===== -->
<main class="main-content">
    <div class="container-fluid">

        <!-- Welcome Banner -->
        <div class="welcome-banner mb-4">
            <div class="welcome-content">
                <h2 class="welcome-title">
                    Xin ch√†o, <span th:text="${patient != null ? patient.fullName : 'B·ªánh nh√¢n'}"></span> üëã
                </h2>
                <p class="welcome-subtitle">Ch√∫c b·∫°n m·ªôt ng√†y kh·ªèe m·∫°nh v√† vui v·∫ª</p>
                <a th:href="@{/patient/appointments/create}" class="btn btn-light welcome-btn">
                    <i class="bi bi-calendar-plus me-2"></i>ƒê·∫∑t l·ªãch ngay
                </a>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="row g-4 mb-4">
            <!-- Upcoming Appointment Card -->
            <div class="col-md-4">
                <div class="summary-card">
                    <div class="summary-icon summary-icon-primary">
                        <i class="bi bi-calendar-check"></i>
                    </div>
                    <div class="summary-content">
                        <div class="summary-label">L·ªãch h·∫πn s·∫Øp t·ªõi</div>
                        <div class="summary-value" th:if="${nearestAppointment != null}">
                            <span th:text="${#temporals.format(nearestAppointment.startTime, 'HH:mm')}">09:00</span>
                            <span class="summary-month" th:text="${#temporals.format(nearestAppointment.date, 'dd/MM')}">15/01</span>
                        </div>
                        <div class="summary-value" th:if="${nearestAppointment == null}">
                            <span>Ch∆∞a c√≥</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pending Support Requests -->
            <div class="col-md-4">
                <div class="summary-card">
                    <div class="summary-icon summary-icon-warning">
                        <i class="bi bi-headset"></i>
                    </div>
                    <div class="summary-content">
                        <div class="summary-label">Y√™u c·∫ßu h·ªó tr·ª£ ƒëang ch·ªù</div>
                        <div class="summary-value">
                            <span th:text="${pendingSupportCount != null ? pendingSupportCount : 0}">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Notifications -->
            <div class="col-md-4">
                <div class="summary-card">
                    <div class="summary-icon summary-icon-info">
                        <i class="bi bi-bell"></i>
                    </div>
                    <div class="summary-content">
                        <div class="summary-label">Th√¥ng b√°o m·ªõi</div>
                        <div class="summary-value">
                            <span th:text="${unreadCount != null ? unreadCount : 0}">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Row -->
        <div class="row g-4">
            <!-- Left Column: Statistics & Quick Actions -->
            <div class="col-lg-8">
                <!-- Visit Statistics -->
                <div class="card border-0 shadow-sm card-rounded mb-4">
                    <div class="card-header-statistics">
                        <div>
                            <h5 class="mb-1">Th·ªëng k√™ l∆∞·ª£t kh√°m</h5>
                            <span class="text-muted small">6 th√°ng g·∫ßn ƒë√¢y</span>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <canvas id="visitChart" height="100"></canvas>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card border-0 shadow-sm card-rounded">
                    <div class="card-body p-4">
                        <h5 class="mb-4">Thao t√°c nhanh</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <a th:href="@{/patient/appointments/create}" class="quick-action-card">
                                    <div class="quick-action-icon">
                                        <i class="bi bi-calendar-plus"></i>
                                    </div>
                                    <div class="quick-action-text">ƒê·∫∑t l·ªãch kh√°m</div>
                                </a>
                            </div>
                            <div class="col-md-4">
                                <a href="#" class="quick-action-card">
                                    <div class="quick-action-icon">
                                        <i class="bi bi-qr-code-scan"></i>
                                    </div>
                                    <div class="quick-action-text">Check-in online</div>
                                </a>
                            </div>
                            <div class="col-md-4">
                                <a th:href="@{/patient/medical-records}" class="quick-action-card">
                                    <div class="quick-action-icon">
                                        <i class="bi bi-file-medical"></i>
                                    </div>
                                    <div class="quick-action-text">H·ªì s∆° y t·∫ø</div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Nearest Appointment -->
            <div class="col-lg-4">
                <div class="card border-0 shadow-sm card-rounded nearest-appointment-card" 
                     th:if="${nearestAppointment != null}">
                    <div class="card-body p-4">
                        <h5 class="mb-4">L·ªãch h·∫πn g·∫ßn nh·∫•t</h5>
                        <div class="nearest-appointment-content">
                            <div class="dentist-info mb-3">
                                <div class="dentist-avatar">
                                    <i class="bi bi-person-circle"></i>
                                </div>
                                <div>
                                    <div class="dentist-name" 
                                         th:text="${nearestAppointment.dentist != null and nearestAppointment.dentist.user != null ? nearestAppointment.dentist.user.email : 'Nha sƒ©'}">
                                        Dr. Nguy·ªÖn VƒÉn A
                                    </div>
                                    <div class="dentist-specialty" 
                                         th:text="${nearestAppointment.dentist != null ? (nearestAppointment.dentist.specialization != null ? nearestAppointment.dentist.specialization : 'Nha sƒ© t·ªïng qu√°t') : 'Nha sƒ© t·ªïng qu√°t'}">
                                        Nha sƒ© t·ªïng qu√°t
                                    </div>
                                </div>
                            </div>
                            <div class="appointment-datetime mb-3">
                                <div class="datetime-item">
                                    <i class="bi bi-calendar3 me-2"></i>
                                    <span th:text="${#temporals.format(nearestAppointment.date, 'dd/MM/yyyy')}">15/01/2024</span>
                                </div>
                                <div class="datetime-item">
                                    <i class="bi bi-clock me-2"></i>
                                    <span th:text="${#temporals.format(nearestAppointment.startTime, 'HH:mm')} + ' - ' + ${#temporals.format(nearestAppointment.endTime, 'HH:mm')}">09:00 - 10:00</span>
                                </div>
                            </div>
                            <button class="btn btn-primary w-100">
                                <i class="bi bi-check-circle me-2"></i>X√°c nh·∫≠n l·ªãch
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Empty state -->
                <div class="card border-0 shadow-sm card-rounded text-center py-5" 
                     th:if="${nearestAppointment == null}">
                    <i class="bi bi-calendar-x display-4 text-muted mb-3"></i>
                    <h6 class="text-muted">Ch∆∞a c√≥ l·ªãch h·∫πn</h6>
                    <a th:href="@{/patient/appointments/create}" class="btn btn-primary btn-sm mt-3">
                        ƒê·∫∑t l·ªãch ngay
                    </a>
                </div>
            </div>
        </div>

    </div>
</main>

<!-- Floating Chat Button -->
<div class="floating-chat-btn">
    <button class="btn btn-success rounded-circle p-3 shadow-lg" 
            data-bs-toggle="tooltip" 
            data-bs-placement="left" 
            title="Chat v·ªõi L·ªÖ t√¢n">
        <i class="bi bi-chat-dots fs-4"></i>
    </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Visit Statistics Chart
    const visitStats = /*[[${visitStatistics}]]*/ [12, 15, 18, 14, 16, 20];
    const months = ['Th√°ng 7', 'Th√°ng 8', 'Th√°ng 9', 'Th√°ng 10', 'Th√°ng 11', 'Th√°ng 12'];
    
    const ctx = document.getElementById('visitChart');
    if (ctx) {
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: months,
                datasets: [{
                    label: 'L∆∞·ª£t kh√°m',
                    data: visitStats,
                    borderColor: '#14b8a6',
                    backgroundColor: 'rgba(20, 184, 166, 0.1)',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 5,
                    pointBackgroundColor: '#14b8a6',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: '#f1f5f9'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    }

    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
</script>
</body>
</html>
