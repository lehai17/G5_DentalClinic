<!doctype html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ho tro chuyen mon</title>

  <link rel="stylesheet" th:href="@{/css/dentist/app.css}"/>
  <link rel="stylesheet" th:href="@{/css/dentist/support.css}"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"/>
</head>
<body>
<div class="app-shell">

  <aside class="sidebar" id="sidebar" style="display:flex;flex-direction:column;height:100vh;">
    <div class="sidebar-top">
      <div class="brand-mini">
        <div class="brand-badge">D+</div>
        <div style="font-weight:800">DentalPlus</div>
      </div>
    </div>

    <nav class="nav">
      <a class="nav-item" href="/dentist/dashboard">Tong quan</a>
      <a class="nav-item" href="/dentist/work-schedule">Lich lam viec</a>
      <a class="nav-item active" href="/dentist/support">Ho tro chuyen mon</a>
      <a class="nav-item" href="/dentist/profile">Ho so</a>
    </nav>

    <div style="margin-top:auto;">
      <a class="nav-item danger" href="/logout">Dang xuat</a>
    </div>
  </aside>

  <div class="main">
    <div class="topbar">
      <div class="support-breadcrumb">Bac si / Ho tro chuyen mon</div>
    </div>

    <div class="content">
      <section class="support-panel">
        <header class="support-header">
          <div>
            <h1 class="support-title">Phieu ho tro khach hang</h1>
            <p class="support-sub">Xu ly cau hoi lien quan ca kham cua ban hoac cac yeu cau ho tro chung.</p>
          </div>

          <form method="get" th:action="@{/dentist/support}" class="support-filter">
            <label for="status">Trang thai</label>
            <select id="status" name="status">
              <option value="" th:selected="${selectedStatus == ''}">Tat ca</option>
              <option value="OPEN" th:selected="${selectedStatus == 'OPEN'}">Dang mo</option>
              <option value="ANSWERED" th:selected="${selectedStatus == 'ANSWERED'}">Da tra loi</option>
              <option value="CLOSED" th:selected="${selectedStatus == 'CLOSED'}">Da dong</option>
            </select>
            <button type="submit" class="btn primary support-filter-btn">Loc</button>
          </form>
        </header>

        <div th:if="${successMessage}" class="support-flash flash-success" th:text="${successMessage}"></div>
        <div th:if="${errorMessage}" class="support-flash flash-error" th:text="${errorMessage}"></div>

        <div class="support-empty" th:if="${#lists.isEmpty(tickets)}">
          <i class="bi bi-chat-left-text"></i>
          <h3>Chua co phieu ho tro phu hop</h3>
          <p>Khi khach hang gui cau hoi moi, danh sach se hien thi tai day.</p>
        </div>

        <div class="support-table-wrap" th:if="${!#lists.isEmpty(tickets)}">
          <table class="support-table">
            <thead>
            <tr>
              <th>Khach hang</th>
              <th>Loai ho tro</th>
              <th>Cau hoi</th>
              <th>Tao luc</th>
              <th>Trang thai</th>
              <th>Thao tac</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="t : ${tickets}">
              <td>
                <div class="customer-name"
                     th:text="${t.customer != null ? (t.customer.customerProfile != null ? t.customer.customerProfile.fullName : t.customer.email) : '-'}"></div>
                <div class="customer-email" th:text="${t.customer != null ? t.customer.email : ''}"></div>
              </td>
              <td>
                <span class="ticket-type" th:if="${t.appointment != null}">
                  Lien quan ca kham #<span th:text="${t.appointment.id}"></span>
                </span>
                <span class="ticket-type ticket-type-general" th:if="${t.appointment == null}">Ho tro chung</span>
              </td>
              <td>
                <div class="ticket-title" th:text="${t.title}"></div>
                <div class="ticket-question"
                     th:text="${t.question != null && t.question.length() > 110 ? t.question.substring(0,110) + '...' : t.question}"></div>
              </td>
              <td th:text="${#temporals.format(t.createdAt,'dd/MM/yyyy HH:mm')}"></td>
              <td>
                <span class="badge open" th:if="${t.status.name() == 'OPEN'}">Dang mo</span>
                <span class="badge answered" th:if="${t.status.name() == 'ANSWERED'}">Da tra loi</span>
                <span class="badge closed" th:if="${t.status.name() == 'CLOSED'}">Da dong</span>
              </td>
              <td>
                <a class="action-link" th:href="@{'/dentist/support/' + ${t.id}}">
                  Xem chi tiet <i class="bi bi-arrow-right-short"></i>
                </a>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </div>
</div>
</body>
</html>
