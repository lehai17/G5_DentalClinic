<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Work Schedule</title>
  <link rel="stylesheet" href="/css/app.css"/>
</head>

<body>
<div class="app-shell">

  <!-- SIDEBAR -->
  <aside id="sidebar" class="sidebar" style="display:flex; flex-direction:column;">
    <div class="sidebar-top">
      <div class="brand-mini">
        <div class="brand-badge">D+</div>
        <div style="font-weight:800">DentalPlus</div>
      </div>
      <button id="sidebarToggle" class="icon-btn" type="button">☰</button>
    </div>

    <nav class="nav">
      <a class="nav-item active" th:href="@{/dentist/work-schedule(dentistUserId=${dentistUserId})}">Work Schedule</a>
      <a class="nav-item" href="/dentist/support-tickets">Support Tickets</a>
      <a class="nav-item" href="/dentist/profile">Profile</a>
    </nav>

    <!-- ✅ SIGN OUT xuống đáy -->
    <div style="margin-top:auto;">
      <a class="nav-item danger" href="/logout">Sign Out</a>
    </div>
  </aside>

  <!-- MAIN -->
  <div class="main">
    <div class="topbar">
      <div>
        <div style="color:var(--muted);font-size:12px;">Modules &nbsp;›&nbsp; Work Schedule</div>
      </div>
      <a href="/dentist/profile" class="user-chip">
        <div class="user-name" th:text="${dentistName}">Dr. Sarah Thompson</div>
        <div class="user-sub">General Dentist</div>
      </a>
    </div>

    <div class="content">
      <h2 style="margin:6px 0 4px;">Weekly Schedule</h2>
      <div style="color:var(--muted);margin-bottom:10px;">
        <span th:text="${#temporals.format(weekStart,'dd/MM/yyyy')}">26/01/2026</span>
        -
        <span th:text="${#temporals.format(weekEnd,'dd/MM/yyyy')}">01/02/2026</span>
      </div>

      <!-- ✅ CHỈ 1 DROPDOWN TUẦN (bỏ hết nút) -->
      <div class="filter" style="align-items:center;">
        <div class="field" style="min-width:260px;">
          <label>Week range</label>
          <select id="weekSelect"
                  style="width:260px;padding:10px;border:1px solid var(--line);border-radius:10px;">
            <option th:each="w : ${weekOptions}"
                    th:value="${w.value}"
                    th:text="${w.label}"
                    th:selected="${w.value == selectedWeekStart}">
              26/01 To 01/02
            </option>
          </select>
        </div>

        <input type="hidden" id="dentistUserIdHidden" th:value="${dentistUserId}">
      </div>

      <!-- ✅ GRID -->
      <div class="schedule-grid">
        <div class="grid-head">
          <div class="time-col"></div>
          <div class="day-col" th:each="d : ${days}" th:text="${#temporals.format(d,'EEEE')}">Monday</div>
        </div>

        <div class="grid-body">
          <div class="row" th:each="t : ${timeSlots}">
            <div class="time-col" th:text="${#temporals.format(t,'HH:mm')}">09:00</div>

            <div class="cell" th:each="d : ${days}">
              <th:block th:with="
      key=${d.toString() + '_' + #temporals.format(t,'HH:mm')},
      ev=${eventMap.get(key)}
  ">
                <div th:if="${showAppointments and ev != null}"
                     class="appt">
                  <div class="appt-name" th:text="${ev.patientName}"></div>
                  <div class="appt-sub" th:text="${ev.serviceName}"></div>
                </div>
              </th:block>
            </div>

          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ✅ MODAL: chỉ hiện khi click, có nút X -->
<div id="apptModalBackdrop" class="modal-backdrop" hidden>
  <div class="modal" role="dialog" aria-modal="true">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div id="apptModalTitle" class="modal-title">Appointment</div>
        <div id="apptModalSub" class="modal-sub">Choose action</div>
      </div>

      <!-- ✅ DẤU X -->
      <button id="btnCloseModal" class="icon-btn" type="button" title="Close">✕</button>
    </div>

    <div class="modal-actions">
      <a id="btnBillingTransfer" class="btn" href="#">Service &amp; Billing Transfer</a>
      <a id="btnExamination" class="btn primary" href="#">Clinical Examination Process</a>
    </div>
  </div>
</div>

<script src="/js/app.js"></script>

<!-- ✅ dropdown change -->
<script>
  document.getElementById('weekSelect')?.addEventListener('change', (e) => {
    const weekStart = e.target.value;
    const dentistUserId = document.getElementById('dentistUserIdHidden')?.value || '';
    window.location.href = `/dentist/work-schedule?dentistUserId=${dentistUserId}&weekStart=${weekStart}`;
  });
</script>

</body>
</html>
