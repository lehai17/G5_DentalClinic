<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Work Schedule</title>
  <link rel="stylesheet" href="/css/dentist/app.css"/>
</head>

<body>
<div class="app-shell">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar"
         style="display:flex;flex-direction:column;height:100vh;">

  <div class="sidebar-top">
      <div class="brand-mini">
        <div class="brand-badge">D+</div>
        <div style="font-weight:800">DentalPlus</div>
      </div>
    </div>

    <nav class="nav">
      <a class="nav-item" href="/dentist/dashboard">Dashboard</a>
      <a class="nav-item active">Work Schedule</a>
        <a class="nav-item" href="/dentist/busy-schedule">Busy Schedule</a>
      <a class="nav-item" href="/dentist/support">Support Ticket</a>
      <a class="nav-item" href="/dentist/profile">Profile</a>
    </nav>

    <div style="margin-top:auto;">
      <a class="nav-item danger" href="/logout">Sign Out</a>
    </div>
  </aside>

  <!-- MAIN -->
  <div class="main">

    <div class="topbar">
      <div style="color:var(--muted);font-size:12px;">Modules › Work Schedule</div>
    </div>

    <div class="content">

      <h2>Weekly Schedule</h2>
      <div style="color:var(--muted);margin-bottom:10px;">
        <span th:text="${#temporals.format(weekStart,'dd/MM/yyyy')}"></span>
        -
        <span th:text="${#temporals.format(weekEnd,'dd/MM/yyyy')}"></span>
      </div>

      <!-- WEEK SELECT -->
      <div class="filter">
        <div class="field">
          <label>Week range</label>
          <select id="weekSelect">
            <option th:each="w : ${weekOptions}"
                    th:value="${w.value}"
                    th:text="${w.label}"
                    th:selected="${w.value == selectedWeekStart}">
            </option>
          </select>
          <input type="hidden" id="weekStartHidden"
                 th:value="${selectedWeekStart}">

        </div>
        <input type="hidden" id="dentistUserIdHidden" th:value="${dentistUserId}">
      </div>

      <!-- SCHEDULE GRID -->
      <div class="schedule-grid">
        <div class="grid-head">
          <div class="time-col"></div>
          <div class="day-col"
               th:each="d : ${days}"
               th:text="${#temporals.format(d,'EEEE')}">
          </div>
        </div>

        <div class="grid-body">

          <th:block th:each="t : ${timeSlots}">

            <!-- Time column -->
            <div class="time-col"
                 th:text="${#temporals.format(t,'HH:mm')}">
            </div>

            <!-- 7 days -->
            <div class="cell" th:each="d : ${days}">
              <th:block th:with="
        key=${d.toString() + '_' + #temporals.format(t,'HH:mm')},
        ev=${eventMap.get(key)}
      ">
                <div th:if="${ev != null}"
                     class="appt"
                     th:style="'height:' + (${ev.span} * 48 - 4) + 'px; z-index:10;'"

                     th:classappend="
  ${ev.status == 'EXAMINING'} ? ' appt-examining' :
  (${ev.status == 'DONE'} ? ' appt-done' :
  (${ev.status == 'COMPLETED'} ? ' appt-completed' :
  (${ev.status == 'CONFIRMED'} ? ' appt-confirmed' : '')))
"
                     th:attr="
                data-appointment-id=${ev.appointmentId},
                data-patient-name=${ev.patientName},
                data-service-name=${ev.serviceName},
                data-customer-user-id=${ev.customerUserId},
                data-dentist-user-id=${dentistUserId},
                data-status=${ev.status}
                ">
<!--                  <div style="font-size:11px;color:red;"-->
<!--                       th:text="${ev.startTime} + ' - ' + ${ev.endTime} + ' | span=' + ${ev.span}">-->
<!--                  </div>-->
                  <div class="appt-name" th:text="${ev.patientName}"></div>
                  <div class="appt-sub" th:text="${ev.serviceName}"></div>

                </div>
              </th:block>
            </div>

          </th:block>


          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ================= MODAL ================= -->
<div id="apptModalBackdrop" class="modal-backdrop" hidden>
  <div class="modal" role="dialog" aria-modal="true">

    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div id="apptModalTitle" class="modal-title">Appointment</div>
        <div id="apptModalSub" class="modal-sub">Choose action</div>
      </div>
      <button id="btnCloseModal" class="icon-btn">✕</button>
    </div>

    <div class="modal-actions"
         style="
       display:flex;
       gap:12px;
       justify-content:space-between;
       align-items:center;
       width:100%;
       box-sizing:border-box;
     ">

      <a id="btnExamination"
         class="btn primary"
         style="width:auto;white-space:nowrap;">
        Clinical Examination Process
      </a>
      <a id="btnBillingTransfer"
         class="btn"
         style="width:auto;white-space:nowrap;">
        Service & Billing Transfer
      </a>

    </div>

  </div>
</div>

<!-- ================= JS INLINE  ================= -->
<script src="/js/dentist/app.js"></script>


</body>
</html>
